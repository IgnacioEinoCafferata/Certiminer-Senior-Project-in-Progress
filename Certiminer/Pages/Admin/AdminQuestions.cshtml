@page
@model Certiminer.Pages.Admin.AdminQuestionsModel
@attribute [Microsoft.AspNetCore.Authorization.Authorize(Policy = "AdminOnly")]

<section class="page-wrap">
    <div class="glass-panel">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h2>Manage Questions — @Model.Test?.Title</h2>

            <div class="d-flex gap-2">
                <a class="btn btn-secondary"
                   asp-page="/Admin/AdminTestEdit"
                   asp-route-id="@Model.Test?.Id">
                    Edit Test
                </a>

                <a class="btn btn-primary"
                   asp-page="/Admin/AdminQuestionEdit"
                   asp-route-testId="@Model.Test?.Id">
                    Add Question
                </a>
            </div>
        </div>

        <table class="table">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Question</th>
                    <th>Active</th>
                    <th class="text-end"></th>
                </tr>
            </thead>
            <tbody>
                @for (var i = 0; i < Model.Items.Count; i++)
                {
                    var q = Model.Items[i];
                    <tr>
                        <td>@(i + 1)</td>                 @* empieza en 1 *@
                        <td>@q.Prompt</td>
                        <td>@(q.IsActive ? "Yes" : "No")</td>
                        <td class="text-end">
                            <a class="btn btn-sm btn-outline-primary me-2"
                               asp-page="/Admin/AdminQuestionEdit"
                               asp-route-testId="@Model.Test!.Id"
                               asp-route-id="@q.Id">
                                Edit
                            </a>

                            <form method="post"
                                  asp-page-handler="Delete"
                                  asp-route-testId="@Model.Test!.Id"
                                  asp-route-id="@q.Id"
                                  class="d-inline">
                                <button type="submit"
                                        class="btn btn-sm btn-outline-danger"
                                        onclick="return confirm('Delete this question?');">
                                    Delete
                                </button>
                            </form>
                        </td>
                    </tr>
                }
            </tbody>
        </table>

    </div>
</section>
