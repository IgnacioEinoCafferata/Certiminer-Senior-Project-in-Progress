@page "/TakeTest"
@model Certiminer.Pages.TakeTestModel

@{
    ViewData["Title"] = Model.Test?.Title ?? "Take Test";
}

<section class="page-wrap">
    <div class="container">
        <div class="glass-panel">

            <h2 class="mb-3">@ViewData["Title"]</h2>

            @if (Model.Test is null)
            {
                <div class="alert alert-danger">Test not found or inactive.</div>
            }
            else
            {
                @if (Model.Submitted)
                {
                    <div class="alert alert-info">
                        <strong>Result:</strong> @Model.Score / @Model.TotalQuestions correct.
                    </div>
                }

                <form method="post">
                    <input type="hidden" name="testId" value="@Model.Test.Id" />

                    @for (int i = 0; i < Model.Questions.Count; i++)
                    {
                        var q = Model.Questions[i];
                        <div class="mb-4">
                            <h5 class="mb-2">Q@(i + 1). @q.Text</h5>

                            @if (q.Options.Count == 0)
                            {
                                <div class="text-muted small">This question has no options.</div>
                            }
                            else
                            {
                                foreach (var opt in q.Options)
                                {
                                    var inputId = $"q{q.Id}_o{opt.Id}";
                                    <div class="form-check">
                                        <input class="form-check-input"
                                               type="radio"
                                               name="ans_@q.Id"
                                               id="@inputId"
                                               value="@opt.Id"
                                        @(q.SelectedOptionId == opt.Id ? "checked" : "") />
                                        <label class="form-check-label" for="@inputId">
                                            @opt.Text
                                            @if (Model.Submitted && opt.IsCorrect)
                                            {
                                                <span class="badge bg-success ms-1">correct</span>
                                            }
                                        </label>
                                    </div>
                                }

                                @if (Model.Submitted && q.SelectedOptionId.HasValue && q.SelectedOptionId != q.CorrectOptionId)
                                {
                                    <div class="text-danger small mt-1">Your answer was incorrect.</div>
                                }
                            }
                        </div>
                    }

                    <div class="mt-3 d-flex gap-2">
                        <button class="btn btn-yellow">Submit</button>
                        <a class="btn btn-secondary" asp-page="/TestsList">Back</a>
                    </div>
                </form>
            }
        </div>
    </div>
</section>
